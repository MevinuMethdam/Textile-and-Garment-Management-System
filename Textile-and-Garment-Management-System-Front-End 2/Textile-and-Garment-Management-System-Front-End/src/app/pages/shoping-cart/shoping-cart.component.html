<div class="banner">
  <app-navbar></app-navbar>

  <div class="wrap">
    <header class="head">
      <h2>Shopping Cart</h2>
      <a routerLink="/ready-made-order-add" class="btn-back"
        >← Continue Shopping</a
      >
    </header>

    <!-- ✅ Read-only customer info (no inputs) -->
    <div class="customer-info" *ngIf="customerId || customerName">
      <span>Customer:</span>
      <strong>#{{ customerId || "—" }}</strong>
      <span>•</span>
      <strong>{{ customerName || "—" }}</strong>
    </div>
    <!-- ===== end customer info ===== -->

    <ng-container *ngIf="items.length; else empty">
      <div class="table">
        <div class="thead">
          <div>Item</div>
          <div class="right">Price (LKR)</div>
          <div class="center">Qty</div>
          <div class="right">Line Total (LKR)</div>
          <div></div>
        </div>

        <div class="row" *ngFor="let it of items; let i = index">
          <div class="cell title">
            <div class="thumb" *ngIf="it.product.imageUrl">
              <img [src]="it.product.imageUrl" [alt]="it.product.name" />
            </div>
            <div class="name">{{ it.product.name }}</div>
          </div>

          <div class="cell right">
            {{ it.product.price | number : "1.0-0" }}
          </div>

          <div class="cell center qty">
            <button type="button" (click)="dec(it.product.id)">−</button>

            <input
              type="number"
              min="1"
              [ngModel]="it.qty"
              (ngModelChange)="setQty(it.product.id, $event)"
              class="qty-input"
            />

            <button type="button" (click)="inc(it.product.id)">+</button>
          </div>

          <div class="cell right strong">
            {{ it.lineTotal | number : "1.0-0" }}
          </div>

          <div class="cell right">
            <button class="btn-remove" (click)="remove(it.product.id)">
              Remove
            </button>
          </div>
        </div>
      </div>

      <div class="summary">
        <div class="row">
          <span>Items</span>
          <span>{{ itemCount }}</span>
        </div>

        <!-- Discount buttons -->
        <div class="row">
          <span>Discount</span>
          <div class="discounts">
            <button
              *ngFor="let p of discountOptions"
              type="button"
              class="disc"
              [class.active]="selectedDiscount === p"
              (click)="applyDiscount(p)"
            >
              {{ p }}%
            </button>
          </div>
        </div>

        <!-- Totals -->
        <div class="row">
          <span>Subtotal</span>
          <span>LKR {{ subtotal | number : "1.0-0" }}</span>
        </div>
        <div class="row">
          <span>Discount ({{ selectedDiscount }}%)</span>
          <span>- LKR {{ discountAmount | number : "1.0-0" }}</span>
        </div>
        <div class="row total">
          <span>Total</span>
          <span>LKR {{ total | number : "1.0-0" }}</span>
        </div>

        <button class="btn-checkout" (click)="checkout()">Checkout</button>
      </div>
    </ng-container>

    <ng-template #empty>
      <div class="empty">
        <p>Your cart is empty.</p>
        <a routerLink="/ready-made-order-add" class="btn-back"
          >Browse Products</a
        >
      </div>
    </ng-template>
  </div>
</div>
